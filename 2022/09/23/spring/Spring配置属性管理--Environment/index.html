

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="baymax55">
  <meta name="keywords" content="">
  
    <meta name="description" content="Spring配置属性管理--Environment">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring配置属性管理--Environment">
<meta property="og:url" content="https://baymax55.github.io/2022/09/23/spring/Spring%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E7%AE%A1%E7%90%86--Environment/index.html">
<meta property="og:site_name" content="Baymax55&#39;s Blog">
<meta property="og:description" content="Spring配置属性管理--Environment">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://baymax55.github.io/img/index_img/spring.png">
<meta property="article:published_time" content="2022-09-23T03:42:50.020Z">
<meta property="article:modified_time" content="2022-09-23T03:57:23.686Z">
<meta property="article:author" content="baymax55">
<meta property="article:tag" content="spring">
<meta property="article:tag" content="Value">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://baymax55.github.io/img/index_img/spring.png">
  
  
  
  <title>Spring配置属性管理--Environment - Baymax55&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"baymax55.github.io","root":"/","version":"1.9.0","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"eHrEoB5dKeqkOQe92av9bqEs-MdYXbMMI","app_key":"ldBS29kjWy4gjD9MCWKAWxyi","server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>

  
<meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="Baymax55's Blog" type="application/atom+xml">
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>baymax55</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Spring配置属性管理--Environment"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-09-23 11:42" pubdate>
          2022年9月23日 中午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          8.3k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          70 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Spring配置属性管理--Environment</h1>
            
              <p class="note note-info">
                
                  
                    本文最后更新于：2022年9月23日 中午
                  
                
              </p>
            
            <div class="markdown-body">
              
              <p>在上一篇文章中 Spring配置属性管理—Value注解解析我们从@Value注解入手大致讲解了一下配置属性在Spring项目中应用的基本原理，本文将会围绕Spring的Environment对org.springframework.core.env包中的重要类进行进一步的解析。</p>
<blockquote>
<p>The Environment interface is an abstraction integrated in the container that models two key aspects of the application environment: profiles and properties.</p>
<p>A profile is a named, logical group of bean definitions to be registered with the container only if the given profile is active. Beans may be assigned to a profile whether defined in XML or with annotations. The role of the Environment object with relation to profiles is in determining which profiles (if any) are currently active, and which profiles (if any) should be active by default.</p>
<p>Properties play an important role in almost all applications and may originate from a variety of sources: properties files, JVM system properties, system environment variables, JNDI, servlet context parameters, ad-hoc Properties objects, Map objects, and so on. The role of the Environment object with relation to properties is to provide the user with a convenient service interface for configuring property sources and resolving properties from them.</p>
</blockquote>
<p>在Spring的官方文档中我们可以得知，在Spring框架中Environment主要负责两个Profiles于Properties两个部分。这两个部分对于我们而言基本上是耳熟能详的了，Profiles通常用于应用区分环境（例如测试、预发、正式加载不同的属性配置或者是Bean配置），Properties则是Spring用于管理配置文件属性的重要组件。本文我们重点关注一下Properties相关的原理。</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">ApplicationContext ctx = <span class="hljs-keyword">new</span> <span class="hljs-constructor">GenericApplicationContext()</span>;<br>Environment env = ctx.get<span class="hljs-constructor">Environment()</span>;<br>boolean containsMyProperty = env.contains<span class="hljs-constructor">Property(<span class="hljs-string">&quot;my-property&quot;</span>)</span>;<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;Does my environment contain the &#x27;my-property&#x27; property? &quot;</span> + containsMyProperty);<br></code></pre></td></tr></table></figure>
<p>除了在上一篇文章中提到的利用@Value注解来获取配置属性以外，我们还可以通过上面的代码片段利用Environment来获取到配置属性（通常在应用中使用的是自动注入的Environment），默认单机应用的情况下在ApplicationContext中的Environment的具体实现类是StandardEnvironment，在其中配置了两个默认的PropertySource(属性数据源)分别是JVM系统数据以及操作系统环境变量属性，在Spring Web应用中则是由StandardServletEnvironment负责具体的实现，增加了Servlet配置相关的数据源。</p>
<p><img src="img.png" srcset="/img/loading.gif" lazyload></p>
<p>我们围绕这张UML类图来分析StandardEnvironment是如何为Spring应用程序提供属性配置的。</p>
<p>PropertyResolver定义了从属性配置源的获取属性的基本功能接口，主要包含三种类型的接口：获取字符串类型属性、获取指定类型的属性以及利用属性解析字符串中的占位符。</p>
<p>ConfigurablePropertyResolver进一步完善了属性相关的接口定义，提供了自定义属性解析的相关接口，例如配置属性类型转换器、占位符设置等。</p>
<p>而在ConfigurableEnvironment中则定义了获取属性源的相关的接口，在这个接口中我们可以注意到，默认情况下Environment一定会存在两个属性，一个是SystemProperties另一个是SystemEnvironment。</p>
<p>再往下则是AbstractEnvironment，在这个抽象类中实现了大部分的属性相关功能，总的来说可以分为两个部分，也是最重要的两个部分，负责属性存储管理的MutablePropertySources以及负责属性解析的ConfigurablePropertyResolver。</p>
<p>StandardEnvironment与StandardServletEnvironment实际上并没有实现太多的功能，而是根据自己不同的特性为AbstractEnvironment添加了默认的属性源。</p>
<h1 id="MutablePropertySources"><a href="#MutablePropertySources" class="headerlink" title="MutablePropertySources"></a>MutablePropertySources</h1><p>MutablePropertySources实现了PropertySources接口，PropertySources定义了属性源PropertySource容器相关的接口（例如遍历属性源、根据名称获取属性源等），PropertySource与Java中常用的Properties类似，不同的是除了定义了查询属性的方法外，每个属性源还包含一个属性源的名称。</p>
<p>在MutablePropertySources中，使用一个CopyOnWriteArrayList来存储PropertySource，为什么用的不是Map来保存呢？因为不同的属性源是有优先级区别的，高优先级属性会覆盖低优先级的属性（MutablePropertySources提供了addFirst、addLast属性）。那为什么用的不是普通的List而需要用的是CopyOnWriteArrayList呢，因为CopyOnWriteArrayList提供了更加稳定的遍历功能，获取属性源的时候如下所示使用的是遍历的方式，而属性源的变更在应用中通常是低频的。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># org.springframework.core.env.MutablePropertySources.<span class="hljs-keyword">get</span><br>	<span class="hljs-built_in">public</span> PropertySource&lt;?&gt; <span class="hljs-keyword">get</span>(String <span class="hljs-type">name</span>) &#123;<br>		<span class="hljs-type">int</span> <span class="hljs-keyword">index</span> = this.propertySourceList.indexOf(PropertySource.named(<span class="hljs-type">name</span>));<br>		<span class="hljs-keyword">return</span> (<span class="hljs-keyword">index</span> != <span class="hljs-number">-1</span> ? this.propertySourceList.<span class="hljs-keyword">get</span>(<span class="hljs-keyword">index</span>) : <span class="hljs-keyword">null</span>);<br>	&#125;<br><br></code></pre></td></tr></table></figure>

<p>在spring-core的env包下提供了两种比较常用的PropertySource的具体实现类，分别是以Properties作为数据源的PropertiesPropertySource、以Map对象作为数据源的MapPropertySource，以存储系统环境变量的SystemEnvironmentPropertySource为例，继承了MapPropertySource，将System.getenv()返回的属性转换为Map作为数据源，默认的属性源的名称是systemEnvironment。</p>
<p>在前面提到默认的情况下Environment中包含两个JVM系统属性与操作系统属性，那是在什么时候被添加到AbstractEnvironment中的MutablePropertySources的呢，回到StandardEnvironment的customizePropertySources中，这个函数主要是用于不同的Environment来添加自定义的属性。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta"># org.springframework.core.env.StandardEnvironment.customizePropertySources</span><br><br>	@<span class="hljs-function">Override</span><br><span class="hljs-function">	<span class="hljs-keyword">protected</span> <span class="hljs-type">void</span> <span class="hljs-title">customizePropertySources</span><span class="hljs-params">(MutablePropertySources propertySources)</span> </span>&#123;<br>		propertySources.<span class="hljs-built_in">addLast</span>(<br>				<span class="hljs-keyword">new</span> <span class="hljs-built_in">PropertiesPropertySource</span>(SYSTEM_PROPERTIES_PROPERTY_SOURCE_NAME, <span class="hljs-built_in">getSystemProperties</span>()));<br>		propertySources.<span class="hljs-built_in">addLast</span>(<br>				<span class="hljs-keyword">new</span> <span class="hljs-built_in">SystemEnvironmentPropertySource</span>(SYSTEM_ENVIRONMENT_PROPERTY_SOURCE_NAME, <span class="hljs-built_in">getSystemEnvironment</span>()));<br>	&#125;<br></code></pre></td></tr></table></figure>


<h1 id="ConfigurablePropertyResolver"><a href="#ConfigurablePropertyResolver" class="headerlink" title="ConfigurablePropertyResolver"></a>ConfigurablePropertyResolver</h1><p>在上一篇文章中我们提到了无论是AbstractEnvironment还是PropertySourcesPlaceholderConfigurer中，真正负责属性解析的都是PropertySourcesPropertyResolver。PropertySourcesPropertyResolver继承自AbstractPropertyResolver，AbstractPropertyResolver实现了属性解析的大部分的功能模版，例如使用PropertyPlaceholderHelper解析占位符，利用ConfigurableConversionService完成属性到目标类型的转换等，而PropertySourcesPropertyResolver负责数据源的存储以及实现属性获取的基本功能。以下面的函数为例，PropertySourcesPropertyResolver在查找属性时，会遍历所有的PropertySource，首先直接通过key获取属性，当属性不存在的时在解析占位符，最后利用ConversionService完成属性转换。</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"># org.springframework.core.env.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">PropertySourcesPropertyResolver</span>.</span></span>get<span class="hljs-constructor">Property(<span class="hljs-params">java</span>.<span class="hljs-params">lang</span>.String, <span class="hljs-params">java</span>.<span class="hljs-params">lang</span>.Class&lt;T&gt;, <span class="hljs-params">boolean</span>)</span><br><br>	@Nullable<br>	protected &lt;T&gt; T get<span class="hljs-constructor">Property(String <span class="hljs-params">key</span>, Class&lt;T&gt; <span class="hljs-params">targetValueType</span>, <span class="hljs-params">boolean</span> <span class="hljs-params">resolveNestedPlaceholders</span>)</span> &#123;<br>		<span class="hljs-keyword">if</span> (this.propertySources != null) &#123;<br>			<span class="hljs-keyword">for</span> (PropertySource&lt;?&gt; propertySource : this.propertySources) &#123;<br>				<span class="hljs-keyword">if</span> (logger.is<span class="hljs-constructor">TraceEnabled()</span>) &#123;<br>					logger.trace(<span class="hljs-string">&quot;Searching for key &#x27;&quot;</span> + key + <span class="hljs-string">&quot;&#x27; in PropertySource &#x27;&quot;</span> +<br>							propertySource.get<span class="hljs-constructor">Name()</span> + <span class="hljs-string">&quot;&#x27;&quot;</span>);<br>				&#125;<br>				Object value = propertySource.get<span class="hljs-constructor">Property(<span class="hljs-params">key</span>)</span>;<br>				<span class="hljs-keyword">if</span> (value != null) &#123;<br>					<span class="hljs-keyword">if</span> (resolveNestedPlaceholders<span class="hljs-operator"> &amp;&amp; </span>value instanceof String) &#123;<br>						value = resolve<span class="hljs-constructor">NestedPlaceholders((String)</span> value);<br>					&#125;<br>					log<span class="hljs-constructor">KeyFound(<span class="hljs-params">key</span>, <span class="hljs-params">propertySource</span>, <span class="hljs-params">value</span>)</span>;<br>					return convert<span class="hljs-constructor">ValueIfNecessary(<span class="hljs-params">value</span>, <span class="hljs-params">targetValueType</span>)</span>;<br>				&#125;<br>			&#125;<br>		&#125;<br>		<span class="hljs-keyword">if</span> (logger.is<span class="hljs-constructor">TraceEnabled()</span>) &#123;<br>			logger.trace(<span class="hljs-string">&quot;Could not find key &#x27;&quot;</span> + key + <span class="hljs-string">&quot;&#x27; in any property source&quot;</span>);<br>		&#125;<br>		return null;<br>	&#125;<br></code></pre></td></tr></table></figure>

<h1 id="自定义属性数据源"><a href="#自定义属性数据源" class="headerlink" title="自定义属性数据源"></a>自定义属性数据源</h1><p>在上一篇文章中我们知道通过配置PropertySourcesPlaceholderConfigurer可以自动的加载本地的Resource文件，与Environment中的属性组合成一个新的PropertySources，在BeanFactory注入ValueResolver中来使得自定义属性添加到属性解析的流程中。然而通过这种方式注入的属性是无法直接通过Environment获取的，通过上面的简单分析，我们可以得知如果想要在应用中加入自定义的属性源只需要获取到Environment中的MutablePropertySources，将属性源添加到其中即可。那么注入的时间点就非常的重要，如果应用启动后再去注入自定义的属性源的话，那么初始化过程中的@Value注解等就无法获取到自定义的属性数据源。</p>
<p>对于纯原生的Spring项目而言，我们可以在创建ApplicationContext时获取到Environment来完成自定义属性源的注入。当然也可以利用BeanPostProcessor结合EnvironmentAware来获取到Environment完成，但这种方式只受益于Bean，对于在其之前执行的BeanPostProcessor则不生肖。</p>
<p>对于Spring Boot项目而言实际上是有比较明确的注入点的，我们来看下SpringBoot启动的代码片段。首先会根据SPI获取到项目中所有的SpringApplicationRunListeners，然后创建Environment，在prepareEnvironment函数中创建完Environment后会调用listeners.environmentPrepared通过EventPublishingRunListener广播ApplicationEnvironmentPreparedEvent事件，EnvironmentPostProcessorApplicationListener在收到事件后会获取到应用中的EnvironmentPostProcessor调用postProcessEnvironment来自定义处理Environment。在这个监听器中处理自定义数据源的注入是最早的一个注入点（在后续Nacos-spring-boot的项目中我们也会提到）。ConfigDataEnvironmentPostProcessor即是利用了这一机制来完成application.properties配置的加载与注入。</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-meta"># org.springframework.boot.SpringApplication.run(java.lang.String...)</span><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Run the Spring application, creating and refreshing a new</span><br><span class="hljs-comment">	 * &#123;@link ApplicationContext&#125;.</span><br><span class="hljs-comment">	 * @param args the application arguments (usually passed from a Java main method)</span><br><span class="hljs-comment">	 * @return a running &#123;@link ApplicationContext&#125;</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">public</span> ConfigurableApplicationContext run(<span class="hljs-keyword">String</span>... args) &#123;<br>		StopWatch stopWatch = <span class="hljs-keyword">new</span> <span class="hljs-type">StopWatch</span>();<br>		stopWatch.start();<br>		ConfigurableApplicationContext context = <span class="hljs-literal">null</span>;<br>		Collection&lt;SpringBootExceptionReporter&gt; exceptionReporters = <span class="hljs-keyword">new</span> <span class="hljs-type">ArrayList</span>&lt;&gt;();<br>		configureHeadlessProperty();<br>		SpringApplicationRunListeners listeners = getRunListeners(args);<br>		listeners.starting();<br>		<span class="hljs-keyword">try</span> &#123;<br>			ApplicationArguments applicationArguments = <span class="hljs-keyword">new</span> <span class="hljs-type">DefaultApplicationArguments</span>(args);<br>			ConfigurableEnvironment environment = prepareEnvironment(listeners, applicationArguments);<br>			configureIgnoreBeanInfo(environment);<br>			Banner printedBanner = printBanner(environment);<br>			context = createApplicationContext();<br>			exceptionReporters = getSpringFactoriesInstances(SpringBootExceptionReporter.class,<br>					<span class="hljs-keyword">new</span> <span class="hljs-type">Class</span>[] &#123; ConfigurableApplicationContext.<span class="hljs-class"><span class="hljs-keyword">class</span> &#125;, <span class="hljs-title">context</span>);</span><br><span class="hljs-class">			<span class="hljs-title">prepareContext</span>(<span class="hljs-title">context</span>, <span class="hljs-title">environment</span>, <span class="hljs-title">listeners</span>, <span class="hljs-title">applicationArguments</span>, <span class="hljs-title">printedBanner</span>);</span><br><span class="hljs-class">			<span class="hljs-title">refreshContext</span>(<span class="hljs-title">context</span>);</span><br><span class="hljs-class">			<span class="hljs-title">afterRefresh</span>(<span class="hljs-title">context</span>, <span class="hljs-title">applicationArguments</span>);</span><br><span class="hljs-class">			<span class="hljs-title">stopWatch</span>.<span class="hljs-title">stop</span>();</span><br><span class="hljs-class">			<span class="hljs-title">if</span> (<span class="hljs-title">this</span>.<span class="hljs-title">logStartupInfo</span>) </span>&#123;<br>				<span class="hljs-keyword">new</span> <span class="hljs-type">StartupInfoLogger</span>(<span class="hljs-built_in">this</span>.mainApplicationClass).logStarted(getApplicationLog(), stopWatch);<br>			&#125;<br>			listeners.started(context);<br>			callRunners(context, applicationArguments);<br>		&#125;<br>		<span class="hljs-keyword">catch</span> (Throwable ex) &#123;<br>			handleRunFailure(context, ex, exceptionReporters, listeners);<br>			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-type">IllegalStateException</span>(ex);<br>		&#125;<br><br>		<span class="hljs-keyword">try</span> &#123;<br>			listeners.running(context);<br>		&#125;<br>		<span class="hljs-keyword">catch</span> (Throwable ex) &#123;<br>			handleRunFailure(context, ex, exceptionReporters, <span class="hljs-literal">null</span>);<br>			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-type">IllegalStateException</span>(ex);<br>		&#125;<br>		<span class="hljs-keyword">return</span> context;<br>	&#125;<br><br></code></pre></td></tr></table></figure>

<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul>
<li><a target="_blank" rel="noopener" href="https://juejin.cn/post/6992866279061356551/">Spring配置属性管理（二）— Environment</a></li>
</ul>

              
            </div>
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/IT/" class="category-chain-item">IT</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/spring/">#spring</a>
      
        <a href="/tags/Value/">#Value</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Spring配置属性管理--Environment</div>
      <div>https://baymax55.github.io/2022/09/23/spring/Spring配置属性管理--Environment/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>baymax55</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年9月23日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/09/23/spring/Spring%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E7%AE%A1%E7%90%86%E2%80%94%20@Value%E6%B3%A8%E8%A7%A3%E8%A7%A3%E6%9E%90/" title="Spring配置属性管理(一)-Value注解解析">
                        <span class="hidden-mobile">Spring配置属性管理(一)-Value注解解析</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.4.16/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"eHrEoB5dKeqkOQe92av9bqEs-MdYXbMMI","appKey":"ldBS29kjWy4gjD9MCWKAWxyi","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":true,"recordIP":true,"serverURLs":"https://ehreob5d.api.lncldglobal.com","emojiCDN":null,"emojiMaps":null,"enableQQ":true},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访问客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  

  

  

  

  

  

  
    
  




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script>
  (function() {
    var enableLang = CONFIG.code_language.enable && CONFIG.code_language.default;
    var enableCopy = CONFIG.copy_btn;
    if (!enableLang && !enableCopy) {
      return;
    }

    function getBgClass(ele) {
      return Fluid.utils.getBackgroundLightness(ele) >= 0 ? 'code-widget-light' : 'code-widget-dark';
    }

    var copyTmpl = '';
    copyTmpl += '<div class="code-widget">';
    copyTmpl += 'LANG';
    copyTmpl += '</div>';
    jQuery('.markdown-body pre').each(function() {
      var $pre = jQuery(this);
      if ($pre.find('code.mermaid').length > 0) {
        return;
      }
      if ($pre.find('span.line').length > 0) {
        return;
      }

      var lang = '';

      if (enableLang) {
        lang = CONFIG.code_language.default;
        if ($pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2 && $pre.children().hasClass('hljs')) {
          lang = $pre[0].children[0].classList[1];
        } else if ($pre[0].getAttribute('data-language')) {
          lang = $pre[0].getAttribute('data-language');
        } else if ($pre.parent().hasClass('sourceCode') && $pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2) {
          lang = $pre[0].children[0].classList[1];
          $pre.parent().addClass('code-wrapper');
        } else if ($pre.parent().hasClass('markdown-body') && $pre[0].classList.length === 0) {
          $pre.wrap('<div class="code-wrapper"></div>');
        }
        lang = lang.toUpperCase().replace('NONE', CONFIG.code_language.default);
      }
      $pre.append(copyTmpl.replace('LANG', lang).replace('code-widget">',
        getBgClass($pre[0]) + (enableCopy ? ' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>' : ' code-widget">')));

      if (enableCopy) {
        Fluid.utils.createScript('https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js', function() {
          var clipboard = new window.ClipboardJS('.copy-btn', {
            target: function(trigger) {
              var nodes = trigger.parentNode.childNodes;
              for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].tagName === 'CODE') {
                  return nodes[i];
                }
              }
            }
          });
          clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-copy', 'icon-success');
            setTimeout(function() {
              e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-success', 'icon-copy');
            }, 2000);
          });
        });
      }
    });
  })();
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="/js/leancloud.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
